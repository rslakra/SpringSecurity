<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{fragments/layout}">

<head>
    <title>Welcome</title>
</head>

<body>

    <div layout:fragment="pageContent">
        <!-- Hero Section -->
        <div class="page-header">
            <h1>ğŸ›¡ï¸ Spring Security Filter Chain</h1>
            <p class="subtitle">Modern security configuration with SecurityFilterChain approach</p>
        </div>

        <!-- Feature Cards -->
        <div class="feature-grid">
            <div class="feature-card">
                <div class="icon">ğŸ”</div>
                <h3>Authentication</h3>
                <p>Secure login with form-based and HTTP Basic authentication</p>
            </div>
            <div class="feature-card">
                <div class="icon">ğŸ«</div>
                <h3>Authorization</h3>
                <p>Role-based access control with USER and ADMIN roles</p>
            </div>
            <div class="feature-card">
                <div class="icon">â›“ï¸</div>
                <h3>Filter Chain</h3>
                <p>Custom SecurityFilterChain configuration (no WebSecurityConfigurerAdapter)</p>
            </div>
            <div class="feature-card">
                <div class="icon">ğŸ¯</div>
                <h3>Method Security</h3>
                <p>@PreAuthorize, @Secured, and @RolesAllowed annotations</p>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">ğŸš€</div>
                <h3 class="card-title">Quick Actions</h3>
            </div>
            <div class="nav-pills">
                <a class="nav-pill" th:href="@{/login}">ğŸ” Login</a>
                <a class="nav-pill" th:href="@{/user}">ğŸ‘¤ User Dashboard</a>
                <a class="nav-pill" th:href="@{/admin}">âš™ï¸ Admin Panel</a>
                <a class="nav-pill" th:href="@{/all}">ğŸ‘¥ All Roles</a>
                <a class="nav-pill" th:href="@{/about-us}">â„¹ï¸ About Us</a>
                <a class="nav-pill" th:href="@{/contact-us}">âœ‰ï¸ Contact</a>
            </div>
        </div>

        <!-- Default Credentials -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">ğŸ”‘</div>
                <h3 class="card-title">Default Credentials</h3>
            </div>
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="icon primary">ğŸ‘¤</div>
                    <div>
                        <div class="value">user</div>
                        <div class="label">Password: userPass</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="icon success">ğŸ‘‘</div>
                    <div>
                        <div class="value">admin</div>
                        <div class="label">Password: adminPass</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Tester -->
        <div class="card api-tester">
            <h3>Test DELETE Endpoint (Admin Only)</h3>
            <p class="text-muted">This endpoint requires ADMIN role. Login as admin to test.</p>

            <form id="deleteForm">
                <div class="form-group">
                    <label class="form-label">Message to Delete</label>
                    <input class="form-control" type="text" name="message" id="message"
                        placeholder="Enter a resource name to delete..." />
                </div>
                <button type="submit" class="btn btn-danger" id="deleteButton">
                    ğŸ—‘ï¸ Delete Resource
                </button>
            </form>

            <div class="mt-3">
                <label class="form-label">Response:</label>
                <div class="api-response" id="deleteResponse">
                    <em>Response will appear here...</em>
                </div>
            </div>
        </div>

        <!-- Security Info -->
        <div class="card">
            <div class="card-header">
                <div class="card-icon">ğŸ“š</div>
                <h3 class="card-title">About SecurityFilterChain</h3>
            </div>
            <p>
                Starting from Spring Security 5.7.0, the <code>WebSecurityConfigurerAdapter</code> is deprecated.
                This application demonstrates the modern approach using <code>SecurityFilterChain</code> beans.
            </p>
            <div class="code-block">
                <code>
@Bean<br/>
public SecurityFilterChain filterChain(HttpSecurity http) {<br/>
&nbsp;&nbsp;return http<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.authorizeHttpRequests(auth -> auth<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.requestMatchers("/admin/**").hasRole("ADMIN")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.anyRequest().authenticated())<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.formLogin(form -> form.loginPage("/login"))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;.build();<br/>
}
            </code>
            </div>
        </div>
    </div>

    <th:block layout:fragment="optional">
        <script th:inline="javascript">
            document.addEventListener('DOMContentLoaded', function () {
                const form = document.getElementById('deleteForm');
                const responseDiv = document.getElementById('deleteResponse');

                form.addEventListener('submit', function (e) {
                    e.preventDefault();

                    const message = document.getElementById('message').value;
                    const baseUrl = window.location.origin + '/spring-security-filter-chain';

                    fetch(baseUrl + '/delete', {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'X-Api-Key': 'rslakra'
                        },
                        body: 'message=' + encodeURIComponent(message)
                    })
                        .then(response => {
                            if (response.ok) {
                                return response.text();
                            } else if (response.status === 401) {
                                throw new Error('âš ï¸ Unauthorized: Please login first');
                            } else if (response.status === 403) {
                                throw new Error('ğŸš« Forbidden: Admin role required');
                            } else {
                                throw new Error('Error: ' + response.status);
                            }
                        })
                        .then(html => {
                            responseDiv.innerHTML = '<span class="text-success">âœ… ' + html + '</span>';
                        })
                        .catch(error => {
                            responseDiv.innerHTML = '<span class="text-danger">' + error.message + '</span>';
                        });
                });
            });
        </script>
    </th:block>

</body>

</html>